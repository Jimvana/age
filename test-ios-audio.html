<!DOCTYPE html>
<html>
<head>
    <title>iOS Audio Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:active {
            background: #1976D2;
        }
        .success {
            background: #4CAF50;
        }
        .error {
            background: #f44336;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>iOS Audio Test</h1>
    
    <div id="status" class="status">Ready to test</div>
    
    <button onclick="testWebAudio()">Test Web Audio API</button>
    <button onclick="testHTMLAudio()">Test HTML5 Audio</button>
    <button onclick="testDataURI()">Test Data URI Audio</button>
    <button onclick="testYourSounds()">Test Your Sound Files</button>
    
    <h3>Enter your sound URLs:</h3>
    <input type="url" id="passUrl" placeholder="Pass sound URL" style="width: 100%; padding: 10px; margin: 5px 0;">
    <input type="url" id="failUrl" placeholder="Fail sound URL" style="width: 100%; padding: 10px; margin: 5px 0;">
    <button onclick="testCustomSounds()">Test Custom URLs</button>
    
    <h3>Log:</h3>
    <div id="log" class="log"></div>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f44336' : type === 'success' ? '#4CAF50' : '#333';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + type;
        }
        
        // Test Web Audio API
        function testWebAudio() {
            log('Testing Web Audio API...');
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const ctx = new AudioContext();
                
                if (ctx.state === 'suspended') {
                    log('AudioContext suspended, resuming...');
                    ctx.resume();
                }
                
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.value = 440;
                gainNode.gain.value = 0.3;
                
                oscillator.start();
                oscillator.stop(ctx.currentTime + 0.5);
                
                log('Web Audio API: Playing 440Hz tone for 0.5s', 'success');
                updateStatus('Web Audio playing!', 'success');
                
            } catch (e) {
                log('Web Audio API failed: ' + e.message, 'error');
                updateStatus('Web Audio failed!', 'error');
            }
        }
        
        // Test HTML5 Audio
        function testHTMLAudio() {
            log('Testing HTML5 Audio...');
            const audio = new Audio();
            
            // MP3 data URI (short beep)
            audio.src = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU2LjM2LjEwMAAAAAAAAAAAAAAA//OEAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAEAAABIADAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDV1dXV1dXV1dXV1dXV1dXV1dXV1dXV1dXV6urq6urq6urq6urq6urq6urq6urq6urq6v////////////////////////////////8AAAAATGF2YzU2LjQxAAAAAAAAAAAAAAAAJAAAAAAAAAAAASDs90hvAAAAAAAAAAAAAAAAAAAA//MUZAAAAAGkAAAAAAAAA0gAAAAATEFN//MUZAMAAAGkAAAAAAAAA0gAAAAARTMu//MUZAYAAAGkAAAAAAAAA0gAAAAAOTku//MUZAkAAAGkAAAAAAAAA0gAAAAANVVV';
            
            audio.volume = 0.5;
            
            audio.addEventListener('canplay', () => {
                log('HTML5 Audio: Can play', 'success');
            });
            
            audio.addEventListener('error', (e) => {
                log('HTML5 Audio error: ' + (audio.error ? audio.error.message : 'Unknown'), 'error');
            });
            
            audio.play()
                .then(() => {
                    log('HTML5 Audio: Playing successfully', 'success');
                    updateStatus('HTML5 Audio playing!', 'success');
                })
                .catch(e => {
                    log('HTML5 Audio play failed: ' + e.message, 'error');
                    updateStatus('HTML5 Audio failed!', 'error');
                });
        }
        
        // Test Data URI
        function testDataURI() {
            log('Testing Data URI audio...');
            const audio = new Audio();
            
            // WAV data URI (tiny beep)
            audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBCuBzvLXiTYIG2m98OScTgwOUajk4bllHQU5k9n1zHkqBSh+0fDEly9vvN6dUBEGOIza8st+LAUqgM7w4Yk2CBpovO2ooU4LDVOX5eSqWBkIR6Hg8bJWCz9+zOXOiDAHF2S77OihUBcFQZzY88p7KwUme8zuz4w4CRxywfPTgjQGHW/A7tCNNwkaPGq07OmjUg0LUaXh47FYHAVGneDjrWIZCUCY3+6wYhYEOpbW8ct7KAUme8vvz4w4ChxywPDTgjYGHm/A7NCNNwkaPWu08+mjUg0LUqbi47BYGwZFnd/gsGMYBj6X1vLMeygFJXzL7s+MOQUZ';
            
            audio.volume = 0.5;
            
            audio.play()
                .then(() => {
                    log('Data URI Audio: Playing successfully', 'success');
                    updateStatus('Data URI playing!', 'success');
                })
                .catch(e => {
                    log('Data URI Audio failed: ' + e.message, 'error');
                    updateStatus('Data URI failed!', 'error');
                });
        }
        
        // Test WordPress sounds
        function testYourSounds() {
            log('Testing Age Estimator sounds...');
            
            if (typeof ageEstimatorPhotoParams === 'undefined') {
                log('ageEstimatorPhotoParams not found!', 'error');
                updateStatus('Plugin params not found!', 'error');
                return;
            }
            
            log('Pass sound URL: ' + ageEstimatorPhotoParams.passSoundUrl);
            log('Fail sound URL: ' + ageEstimatorPhotoParams.failSoundUrl);
            
            // Test pass sound
            if (ageEstimatorPhotoParams.passSoundUrl) {
                const passAudio = new Audio(ageEstimatorPhotoParams.passSoundUrl);
                passAudio.volume = 0.5;
                
                passAudio.play()
                    .then(() => {
                        log('Pass sound playing!', 'success');
                        updateStatus('Pass sound works!', 'success');
                    })
                    .catch(e => {
                        log('Pass sound failed: ' + e.message, 'error');
                        updateStatus('Pass sound failed!', 'error');
                    });
            }
            
            // Test fail sound after delay
            setTimeout(() => {
                if (ageEstimatorPhotoParams.failSoundUrl) {
                    const failAudio = new Audio(ageEstimatorPhotoParams.failSoundUrl);
                    failAudio.volume = 0.5;
                    
                    failAudio.play()
                        .then(() => {
                            log('Fail sound playing!', 'success');
                            updateStatus('Fail sound works!', 'success');
                        })
                        .catch(e => {
                            log('Fail sound failed: ' + e.message, 'error');
                            updateStatus('Fail sound failed!', 'error');
                        });
                }
            }, 2000);
        }
        
        // Test custom URLs
        function testCustomSounds() {
            const passUrl = document.getElementById('passUrl').value;
            const failUrl = document.getElementById('failUrl').value;
            
            if (!passUrl && !failUrl) {
                log('Please enter at least one URL', 'error');
                return;
            }
            
            if (passUrl) {
                log('Testing pass URL: ' + passUrl);
                const audio = new Audio(passUrl);
                audio.volume = 0.5;
                
                audio.play()
                    .then(() => {
                        log('Custom pass sound works!', 'success');
                        updateStatus('Custom pass sound works!', 'success');
                    })
                    .catch(e => {
                        log('Custom pass sound failed: ' + e.message, 'error');
                    });
            }
            
            if (failUrl) {
                setTimeout(() => {
                    log('Testing fail URL: ' + failUrl);
                    const audio = new Audio(failUrl);
                    audio.volume = 0.5;
                    
                    audio.play()
                        .then(() => {
                            log('Custom fail sound works!', 'success');
                            updateStatus('Custom fail sound works!', 'success');
                        })
                        .catch(e => {
                            log('Custom fail sound failed: ' + e.message, 'error');
                        });
                }, 2000);
            }
        }
        
        // Log browser info
        log('User Agent: ' + navigator.userAgent);
        log('iOS Device: ' + (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream));
    </script>
</body>
</html>
